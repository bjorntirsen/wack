{"version":3,"sources":["main.js"],"names":["userId","document","getElementById","value","userName","adminUser","submit_btn","channelId","window","location","href","split","slice","fetchChannels","fetch","headers","then","res","json","data","renderChannels","fetchUsers","renderUsers","sendPostToServer","postBody","content","by","method","body","JSON","stringify","newPost","socket","emit","io","on","renderWhoIsOnline","renderPost","emitUserData","channelList","forEach","channel","li","createElement","classList","add","a","_id","innerHTML","name","appendChild","channels","insertBefore","create","users","user","id","img","src","profilePhoto","alt","usersUl","socketUsers","querySelectorAll","e","remove","Object","entries","map","element","onlineId","item","formattedDate","addZero","i","date_options","dateObj","Date","date","toLocaleDateString","year","month","day","hours","getHours","minutes","getMinutes","post","bySpan","contentP","toString","span","aEdit","aDelete","posts","addEventListener","preventDefault","profilePicInput","label","input","nextElementSibling","labelVal","fileName","target"],"mappings":"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","file":"bundle.js","sourceRoot":"","sourcesContent":["//Global variables\nconst userId = document.getElementById('userId').value;\nconst userName = document.getElementById('userName').value;\nconst adminUser = document.getElementById('adminUser').value;\nconst submit_btn = document.getElementById('submit_btn');\nconst channelId = window.location.href.split('/').slice(-1)[0];\n\n//API functions\n\nconst fetchChannels = () => {\n  fetch('/api/channels', {\n    headers: {\n      'Content-Type': 'application/json',\n    },\n  })\n    .then((res) => res.json())\n    .then((data) => {\n      renderChannels(data);\n    });\n};\n\nconst fetchUsers = () => {\n  fetch('/api/users', {\n    headers: {\n      'Content-Type': 'application/json',\n    },\n  })\n    .then((res) => res.json())\n    .then((data) => {\n      renderUsers(data);\n    });\n};\n\nconst sendPostToServer = () => {\n  const postBody = {\n    content: document.getElementById('content').value,\n    by: userId,\n  };\n  fetch(`/api/channels/${channelId}`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify(postBody),\n  })\n    .then((res) => res.json())\n    .then((newPost) => {\n      socket.emit('postSaved', newPost);\n    });\n};\n\n//Socket functions\n\nconst socket = io();\n\nsocket.on('socketUsersUpdated', renderWhoIsOnline);\n\nsocket.on('postFromServer', renderPost);\n\nconst emitUserData = () => {\n  socket.emit('userDataFromClient', userId, userName);\n};\n\n//Render functions\n\nconst renderChannels = (channelList) => {\n  channelList.forEach((channel) => {\n    const li = document.createElement('li');\n    li.classList.add('channel__li');\n    const a = document.createElement('a');\n    a.href = `/channels/${channel._id}`;\n    a.innerHTML = `#${channel.name}`;\n    li.appendChild(a);\n    channels.insertBefore(li, create);\n  });\n};\n\nconst renderUsers = (users) => {\n  users.forEach((user) => {\n    const li = document.createElement('li');\n    li.classList.add('d-flex');\n    li.id = user._id;\n    const img = document.createElement('img');\n    img.classList.add('icon_image');\n    img.src = user.profilePhoto;\n    img.alt = user.name;\n    li.appendChild(img);\n    const a = document.createElement('a');\n    a.classList.add('user__li');\n    a.href = `/channels/DMorProfile/${user._id}`;\n    a.innerHTML = user.name;\n    li.appendChild(a);\n    usersUl.appendChild(li);\n  });\n};\n\nconst renderWhoIsOnline = (socketUsers) => {\n  document.querySelectorAll('.onlineSpan').forEach((e) => e.remove());\n  let arrayOfSocketUsers = Object.entries(socketUsers).map(\n    (element) => element[1]\n  );\n  arrayOfSocketUsers.forEach((user) => {\n    let onlineId = user.userId + 'online';\n    if (document.getElementById(onlineId) === null) {\n      const item = document.createElement('span');\n      item.innerHTML = ' online';\n      item.classList.add('onlineSpan');\n      if (user.userId === userId) {\n        item.innerHTML += ' (you)';\n      }\n      item.id = user.userId + 'online';\n      const onlineUser = document.getElementById(user.userId);\n      onlineUser.appendChild(item);\n    }\n  });\n};\n\nconst formattedDate = () => {\n  function addZero(i) {\n    if (i < 10) {\n      i = '0' + i;\n    }\n    return i;\n  }\n  const date_options = { year: 'numeric', month: 'long', day: 'numeric' };\n  const dateObj = new Date();\n  const date = dateObj.toLocaleDateString('en-gb', date_options);\n  const hours = addZero(dateObj.getHours());\n  const minutes = addZero(dateObj.getMinutes());\n  return `on ${date} at ${hours}:${minutes}:`;\n};\n\nconst renderPost = (post) => {\n  const li = document.createElement('li');\n  li.classList.add('channel__li');\n  const bySpan = document.createElement('span');\n  bySpan.innerHTML = `By ${post.by.name} ${formattedDate()}`;\n  li.appendChild(bySpan);\n  const contentP = document.createElement('p');\n  contentP.innerHTML = post.content;\n  li.appendChild(contentP);\n  if (userId.toString() === post.by._id.toString() || adminUser === true) {\n    const span = document.createElement('span');\n    const aEdit = document.createElement('a');\n    aEdit.href = `/channels/editPost/${post._id}`;\n    aEdit.innerHTML = 'Edit';\n    span.appendChild(aEdit);\n    const aDelete = document.createElement('a');\n    aDelete.href = `/channels/deletePost/${post._id}`;\n    aDelete.innerHTML = 'Delete';\n    span.appendChild(aDelete);\n    li.appendChild(span);\n  }\n  posts.appendChild(li);\n};\n\n//Event listeners\n\ndocument.addEventListener('DOMContentLoaded', (e) => {\n  e.preventDefault();\n  fetchChannels();\n  fetchUsers();\n  emitUserData();\n});\n\nif (document.getElementById('submit_btn') !== null) {\n  document.getElementById('submit_btn').addEventListener('click', (e) => {\n    e.preventDefault();\n    sendPostToServer();\n    document.getElementById('content').value = '';\n  });\n}\n\nif (document.getElementById('profile_pic') !== null) {\n  const profilePicInput = document.getElementById('profile_pic');\n  const label = input.nextElementSibling;\n  const labelVal = label.innerHTML;\n\n  profilePicInput.addEventListener('change', (e) => {\n    let fileName = '';\n    fileName = e.target.value;\n\n    if (fileName) label.innerHTML = fileName;\n    else label.innerHTML = labelVal;\n  });\n}\n"]}